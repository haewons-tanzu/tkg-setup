#!/usr/bin/env bash
set -euxo pipefail
#tdnf update -y
#tdnf install -y ca-certificates
#tdnf install -y openssl-c_rehash
TRUSTED_CERT="-----BEGIN CERTIFICATE-----
MIIFrTCCA5WgAwIBAgIUBzb33A1gVatWp0vzg0p0qcxmrHUwDQYJKoZIhvcNAQEN
BQAwZjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRIwEAYDVQQHDAlQYWxvIEFs
dG8xDzANBgNVBAoMBlZNd2FyZTEOMAwGA1UECwwFTUFQQlUxFTATBgNVBAMMDDU0
LjI1NS44OC45MzAeFw0yMTA5MjMxMTM4MTJaFw0zMTA5MjExMTM4MTJaMGYxCzAJ
BgNVBAYTAlVTMQswCQYDVQQIDAJDQTESMBAGA1UEBwwJUGFsbyBBbHRvMQ8wDQYD
VQQKDAZWTXdhcmUxDjAMBgNVBAsMBU1BUEJVMRUwEwYDVQQDDAw1NC4yNTUuODgu
OTMwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQC5HCRSGNu/nIa7sU/f
G7yaV6P2/ywbLOh5Pps+YM/E9AyrodaJ/31uekbMD2mlp/lQKolREoa7+oTQTwvm
u/4tvkAzSfVpbLNFxVjlqmraCVLZYpYlDbf7n6mY93ax3RB3nRl66wwU3EpJNEeC
S8c97ALxN9slAATNcDF2SeTsDrbKVVe7XVcU3s+sgqQK3whePj1mH10z6MXo28xF
nULDyKWCvkOgUalqLhJOeEZtVDnYMdvQPNXjluVvAa7JWqHkzQAZS5/BOWRkOrFq
PlhdkZlS1+bACDkTTVbEdBw+/5J0nVSnOkhnrrnHH34pzKV1BfVjcDHpivjRnHsZ
xhXaVlX46ahT2GhfxdyHrOCZuM94BoC2Jgv3SsU9hC4KDIuhbEpiZy20pRxhMFNy
capwUOiNy+rHUg454L7ibqycNq4k7/quzWVabLLRqqltVtBopwprcKRtWz9z0XWv
T9EojbGi42CVt0OKMuhOJsW8gWEbbEZE1CDYUkQLZEx7YdP5tTD3PVlnUtjVnkjm
rbZLnX0bvE5jsbsnUVcf7gbYwr+jcAHptBkl5tY6pL5o/6d2EzU9MTlKctEMYxZ5
IUUlBx3mhTIQ5vkmAZFd61ThfUvnDtMk/drCQbnfHhYnF8yatG7hB2LPh1ytF0DU
ip710Yp2BE+bWfgIhkyEb/MGaQIDAQABo1MwUTAdBgNVHQ4EFgQURBnDwTp9qpTm
RtfZA/JtA2WX/tEwHwYDVR0jBBgwFoAURBnDwTp9qpTmRtfZA/JtA2WX/tEwDwYD
VR0TAQH/BAUwAwEB/zANBgkqhkiG9w0BAQ0FAAOCAgEAcNczABYfyISC/XG0+Kwa
R4hYrcj1jExyweqU+5nPKSxWPoIw1m1mHZ+PF8323NFY1bd/XoMtjTkBlAQVW2EA
JEbwldFKHbNIVDYFjI1DcO6lF9yW04n95XBccIXpsjwhZTvbih/4aXBk6ASW34GG
SCBHeXWVDDPS/Rj8nFwl3Swqqp8Gti/A0zU20FLEvcr7KHqfmSkp1GmJXeYYG+TK
1QInCNd4DuOuDPHZxmWTCpqB649au5Js3oT/mBzWZPtfkvN2PlW3xu61lNjXZ/1R
/HCKuKCRw5PZZj+hBvJNdUM7UiWAmDmJxc2FkPdgT142wdaNHICDQxNPNTJ16PeJ
Hw/VKANkoRaYihOunLny/0q1Q936Ywmncpz27/VGvVKrvHYOOf1uEHElUeMDly0L
1yYhZe1ikQxbMKSUDB3KMxIcmbowNP5yNbUwJOeWTtkXXV3AFLANHfK2VPM2QqVk
2n3pu8tm/Yh/t+Vw7sl9xmB6yeHsw0hAkv3LCPxGRl6YTGRXROi4sUNLCLvbI40w
mRfx9aWiFS6PLnhu8dqGyBkalPp5c3gfhw2zhVS6xlPsUBPPe3Ejj2mRVV99/omD
e6EcrurC9dSyYQgjRaLlNtAstMN3tWeYo9XJL3i8sdG69mXPKITTHT6HQL2HQ5cL
P4XqejAMgDlapOjaj/YX150=
-----END CERTIFICATE-----
"
echo "$TRUSTED_CERT" > /etc/ssl/certs/harbor.crt
/usr/bin/rehash_ca_certificates.sh
echo "Finished, restarting containerd"
systemctl restart containerd
echo "done"
